---
output: github_document
bibliography: "../resources/bib-etc/references-rr.bib"
csl: "../resources/styles/apa.csl"
link-citations: yes
--- 

# data preparation

These exercises are based on Chapter 7 of [@gandrud2014]. 

```{r setup, echo = FALSE}
library(knitr)
opts_knit$set(root.dir = "../")
opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE, collapse = TRUE)
```

## load a new data set

Install the `WDI` package (World Bank Development Indicators). Then, 

```{r}
library(WDI)
library(tidyverse)
```

The `WDI` package includes its own search function.  

```{r echo=FALSE}
# search for the data on consumption of fertilizer
WDIsearch("fertilizer consumption")
```

The subset we'll use from this data is the `AG.CON.FERT.ZS` for kilograms of fertilizer used per hectare of arable land. A hectare (abbreviated "ha") is a unit of area where 100 ha = 1 sq. km. 

```{r}
df <- WDI(indicator = "AG.CON.FERT.ZS")
```


## getting a handle on your data 

The data we downloaded looks like this. The data set appears to be tidy already. 

```{r}
glimpse(df)
```

If we need the specific number of rows or columns or a vector of the column names, we ca use, 

```{r}
nrow(df)
ncol(df)
names(df)
```

Examine basic statistics of the 4 columns 

```{r}
summary(df)
class(df)
```

- From the summary, we see that we have missing values (NAs)
- The object is a data frame (which we like)  

Convert the data frame to a tibble. 

```{r}
df <- as_tibble(df)
class(df)
```


## rename variables 

```{r}
df <- df %>% 
	rename(kg_per_ha = AG.CON.FERT.ZS) 

glimpse(df)
```


## ordering the data 

Data of this sort is often ordered by country then year. 

```{r}
df <- df %>% 
	arrange(country, year)

glimpse(df)
```

## subset the data 

The summary above showed we had some NA values we can filter, 


```{r}
df <- df %>% 
	filter(!is.na(kg_per_ha))

glimpse(df)
```

This box plot shows that there are a small number of countries that are outliers in their consumption of fertilizer.

```{r fig.asp = 8}
ggplot(data = df, aes(x = country, y = kg_per_ha)) +
	geom_boxplot() +
	coord_flip()
```

If we wanted to omit them from the analysis, we would subset the data to omit the two countries as well as all data greater than 3000 kg/ha. 

This data set also includes group of data that is not a country, the "Arab World". We can omit those data 

```{r}
omit_these <- c("Qatar", "Singapore", "Arab World")

df <- df %>% 
	filter(!country %in% omit_these) %>% 
	filter(kg_per_ha <= 3000)

glimpse(df)
```

## recode variables

```{r}
df <- df %>% 
	mutate(country = str_replace(country, "Korea, Rep.", "South Korea"))
```



```{r fig.asp = 8}
ggplot(data = df, aes(x = country, y = kg_per_ha)) +
	geom_boxplot() +
	coord_flip()
```


## references
